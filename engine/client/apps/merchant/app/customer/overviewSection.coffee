a = [{name:"Năm Nứt",description:"Xóm Dưới"},{name:"5 Giàu",description:"Xóm Dưới"},{name:"Chú Phương",description:"Bên Sông"},{name:"Chú Phước",description:"Bên Sông"},{name:"Bác 2 Triều",description:"Bên Sông"},{name:"Chú Đạt",description:"Bên Sông"},{name:"Bác 3 Chiến",description:"Bên Sông"},{name:"Chú Út Lâm",description:"Bên Sông"},{name:"Bác 6 Ao",description:"Bên Sông"},{name:"Hải",description:"Bên Sông"},{name:"Bác 3 Tài",description:"Xóm Dưới"},{name:"Dượng 5 Khoai Lang",description:"Xóm Dưới"},{name:"Út Hằng",description:"Xóm Dưới"},{name:"Cậu 3 Minh",description:"Xóm Dưới"},{name:"5 Tùng",description:"Xóm Dưới"},{name:"5 Oai",description:"Xóm Dưới"},{name:"Chú Voi",description:"Xóm Dưới"},{name:"Bác 2 Tâm",description:"Xóm Dưới"},{name:"Chú Hiếu",description:"Xóm Dưới"},{name:"Anh Hôm",description:"Xóm Dưới"},{name:"Anh Nghĩa",description:"Xóm Dưới"},{name:"Dượng 2 Ty",description:"Xóm Dưới"},{name:"Bác Út Khanh",description:"Xóm Dưới"},{name:"Bác 2 Đô",description:"Xóm Dưới"},{name:"Chú Lâm",description:"Xóm Dưới"},{name:"Anh Tính",description:"Xóm Dưới"},{name:"Bà 7 Que",description:"Xóm Dưới"},{name:"Cậu 2 Ly",description:"Xóm Dưới"},{name:"Tư Nam",description:"Xóm Dưới"},{name:"2 Quỳ",description:"Xóm Dưới"},{name:"2 Cai",description:"Xóm Dưới"},{name:"Bảy Dũng",description:"Ớt-Nợ cũ"},{name:"Anh Sang chùa"},{name:"Anh 2 Lỉnh nợ cũ"},{name:"8 Nhanh",description:"Xóm Dưới"},{name:"7 Tể",description:"Xóm Dưới"},{name:"Mười Út",description:"Xóm Dưới"},{name:"Hoàng Phương",description:"Xóm Dưới"},{name:"Cậu Binh",description:"Xóm Dưới"},{name:"Cậu Dương",description:"Xóm Dưới"},{name:"Năm Trải",description:"Xóm Dưới"},{name:"Chú Hừng",description:"Xóm Dưới"},{name:"Chú Hải",description:"Xóm Dưới"},{name:"Chú Ly",description:"Xóm Dưới"},{name:"Anh Nho",description:"Xóm Dưới"},{name:"Chú Út",description:"Xóm Dưới"},{name:"Út Quyền",description:"Xóm Dưới"},{name:"Chú Thòn",description:"Xóm Dưới"},{name:"Anh Hiền",description:"Xóm Dưới"},{name:"Bác Năm Đắng",description:"Xóm Dưới"},{name:"Anh Đức",description:"Xóm Dưới"},{name:"Năm Cứ",description:"Xóm Dưới"},{name:"Nhỏ",description:"Xóm Dưới"},{name:"Anh Triệt",description:"Xóm Dưới"},{name:"Năm Lóc",description:"Xóm Trên"},{name:"Tám Kiên",description:"Xóm Trên"},{name:"Chị Bé Hai",description:"Xóm Trên"},{name:"Năm Chôm",description:"Xóm Trên"},{name:"Tho Mây",description:"Xóm Trên"},{name:"Tư Bầu",description:"Xóm Trên"},{name:"Anh Sông",description:"Xóm Trên"},{name:"Cậu Bảy Rí",description:"Xóm Trên"},{name:"Bảy Đoàn",description:"Xóm Trên"},{name:"Năm Loan",description:"Xóm Trên"},{name:"Út Ngọc",description:"Xóm Trên"},{name:"Năm Leo",description:"Xóm Trên"},{name:"Tư Kẽn",description:"Xóm Trên"},{name:"Bình - Hai Kiên",description:"Xóm Trên"},{name:"Bác Hai Kiên",description:"Xóm Trên"},{name:"Chú Bi",description:"Xóm Trên"},{name:"Tám Liên",description:"Xóm Trên"},{name:"Ba Lượm",description:"Xóm Trên"},{name:"Dì Sang",description:"Xóm Trên"},{name:"Năm Kĩa",description:"Xóm Trên"},{name:"Năm Mốm",description:"Xóm Trên"},{name:"Cậu Tư Chủng",description:"Xóm Trên"},{name:"Hai Yêm",description:"Xóm Trên"},{name:"Nhựt - Tư Lan",description:"Xóm Trên"},{name:"Dân - Sáu Sễn",description:"Xóm Trên"},{name:"Chín Ngẵm",description:"Xóm Trên"},{name:"Trí",description:"Xóm Trên"},{name:"Hai Thu",description:"Xóm Trên"},{name:"Chú Được",description:"Kiên Lương"},{name:"Dì Hai Lựa",description:"Kiên Lương"},{name:"Anh Vũ",description:"Kiên Lương"},{name:"Anh Ký",description:"Kiên Lương"},{name:"Anh Phong",description:"Kiên Lương"},{name:"Sáu Hộ",description:"Kiên Lương"},{name:"Nhu",description:"Kiên Lương"},{name:"Anh Hùng",description:"Phú Thọ"},{name:"Dì Khuyên",description:"Phú Thọ"},{name:"Dì Khuyên - XOÀI",description:"Phú Thọ"},{name:"Bác Bảy Đức",description:"Tam Nông"},{name:"Chú Bệt",description:"Tam Nông"},{name:"Thương",description:"Tam Nông"},{name:"Chú Sang",description:"Tam Nông"},{name:"Bác Ba Túc",description:"Tam Nông"},{name:"Hai Lượm",description:"Tam Nông"},{name:"Anh Vũ",description:"Tam Nông"},{name:"Anh Huy",description:"Tam Nông"},{name:"Út Tài",description:"Tam Nông"},{name:"Út Điệp",description:"Tam Nông"},{name:"Tư Cảnh",description:"Tam Nông"},{name:"Khang",description:"Kinh Tế"},{name:"Bà Bảy Tờ",description:"Gò Bò"},{name:"Bà Bảy Tờ",description:"Kinh Tế"},{name:"Dì Huệ",description:"Kinh Tế"},{name:"Hai Phủ",description:"Kinh Tế"},{name:"Lành",description:"Kinh Tế"},{name:"Chờ Anh",description:"Kinh Tế"},{name:"Anh Ky",description:"Kinh Tế"},{name:"Bác Tám Lũy",description:"Kinh Tế"},{name:"Hai Dũng",description:"Kinh Tế"},{name:"Út Tùng",description:"Kinh Tế"},{name:"Mười Bông",description:"Kinh Tế"},{name:"Hạnh",description:"Kinh Tế"},{name:"Chia",description:"Kinh Tế"},{name:"Phinh",description:"Kinh Tế"},{name:"Năm Ngây",description:"Kinh Tế"},{name:"Sáu Hải- Bỏ",description:"Phú Lợi"},{name:"Chú Tùng - Tư Tích",description:"Kinh Tế"},{name:"Năm Nghĩa",description:"Kinh Tế"},{name:"Chú Quý",description:"Phú Lợi"},{name:"Chú Bầu",description:"Phú Lợi"},{name:"Chú Tùng",description:"Kinh Tế"},{name:"Chú Dũng",description:"Phú Lợi"},{name:"Chú Nguyên",description:"Kinh Tế"},{name:"Chú Nghĩa - Tư Ô",description:"Kinh Tế"},{name:"Chú Nam",description:"Phú Thọ"},{name:"Tám Bình",description:"Phú Thọ"},{name:"Mười Ca",description:"Phú Thọ"},{name:"Năm Hàm",description:"Phú Thọ"},{name:"Chú Duyên",description:"Phú Thọ"},{name:"Anh Phiêu",description:"Phú Thọ"},{name:"Dì Mai",description:"Phú Thọ"},{name:"Ba Sát",description:"Phú Thọ"},{name:"Ngọc Em",description:"Phú Thọ"},{name:"Bác Ba Đưng Sổ 01",description:"Phú Thọ"},{name:"Trung - Ba Thời",description:"Phú Thọ"},{name:"Thảo Lan",description:"Phú Thọ"},{name:"Tư Cuốn",description:"Phú Thọ"},{name:"Bác Năm Nưng",description:"Phú Thọ"},{name:"Năm Ốc",description:"Phú Thọ"},{name:"Trưng",description:"Phú Thọ"},{name:"Tư Loan",description:"Phú Thọ"},{name:"Sáu Dũng",description:"Phú Thọ"},{name:"Chú Nhàn",description:"Phú Thọ"},{name:"Bác Hai Hồng",description:"Phú Thọ"},{name:"Bác Sáu Hùng",description:"Phú Thọ"},{name:"Cô Hai Lài"},{name:"Bác Hai Hiệp",description:"Phú Thọ"},{name:"Chú Sĩ",description:"Vãng Lai"},{name:"Yến Lừng",description:"Kinh Tế"},{name:"Tư Lấn",description:"Phú Thọ"},{name:"Chị Tám Ân"},{name:"Sang",description:"Phú Thọ"},{name:"Thầy Nham"},{name:"Thông",description:"xóm trên"},{name:"Anh Bảy Đức",description:"Tam Nông"},{name:"Tân",description:"An Giang"},{name:"Chú Tân",description:"Phú Thọ"},{name:"Sáu Lai",description:"Xóm Trên"},{name:"Chị Hai Ngải",description:"Bên Sông"},{name:"Tư Cộm",description:"Xóm Trên"},{name:"Chị Tư Lan",description:"Xóm Trên"},{name:"Đại Lý Năm Măng"},{name:"Chú Toàn",description:"Xóm Trên"},{name:"Anh Tuấn - Khu 3",description:"Sổ 01"},{name:"Bích Thủy - Dì Tám"},{name:"Năm Chuột",description:"Xóm Trên"},{name:"Hoàng Anh - Năm Cua",description:"Nợ Cũ"},{name:"Dụng - Em Cộm",description:"Nợ Cũ"},{name:"Chị Năm Mận - Xóm Dưới",description:"Nợ Cũ"},{name:"Út Đựng - Bên Sông",description:"Nợ Cũ"},{name:"Quậy - Bảy Sương",description:"Nợ Cũ"},{name:"Tư Lùng - Phú Thọ",description:"Nợ Cũ"},{name:"Đức - Hai Ê",description:"Nợ Cũ"},{name:"Út Tuốt - Kiên Lương",description:"Nợ Cũ"},{name:"Phong 3 Tỏ",description:"Nợ Cũ"},{name:"Phượng 3 Tỏ",description:"Nợ Cũ"},{name:"Tiền 6 Tép",description:"Nợ Cũ"},{name:"Sáu Tép",description:"Nợ Cũ"},{name:"Thắng - Cả Nổ",description:"Nợ Cũ"},{name:"Lâm - Em Giàu Chùa",description:"Nợ Cũ"},{name:"Hai Ngôn",description:"Nợ Cũ"},{name:"Sơn - Hai Ngôn",description:"Nợ Cũ"},{name:"Tiến - Em rể Phước",description:"Nợ Cũ"},{name:"Bảy Hải - Phú Thành",description:"Nợ Cũ"},{name:"Cậu Phước em 2 Ty",description:"Nợ Cũ"},{name:"Cọ Sáu Sót - Khu 3",description:"Nợ Cũ"},{name:"Ba Dũng - Tám Dẫu",description:"Nợ Cũ"},{name:"Phước 3 Chuộng",description:"Nợ Cũ"},{name:"Tèo - Con Dì Hương",description:"Nợ Cũ"},{name:"Sốp Méo",description:"Nợ Cũ"},{name:"Thừng 5 Sàng",description:"Nợ Cũ"},{name:"Tuấn - Em Lắc",description:"Nợ Cũ"},{name:"Sang - Em Lắc",description:"Nợ Cũ"},{name:"Sang Sáu Ủi",description:"Nợ Cũ"},{name:"Quốc Hồ",description:"Nợ Cũ"},{name:"Út Chến",description:"Nợ Cũ"},{name:"Dân Hường",description:"Nợ Cũ"},{name:"Cuôi - Hai Beo",description:"Nợ Cũ"},{name:"Hai Beo",description:"Nợ Cũ"},{name:"Cướp - Hai Đúng",description:"Nợ Cũ"},{name:"Thống Hạnh",description:"Nợ Cũ"},{name:"Út Đừng - 8 Luyến",description:"Nợ Cũ"},{name:"Ba Lộp - An Phong",description:"Nợ Cũ"},{name:"Hạnh - Em Hai Biều",description:"Nợ Cũ"},{name:"6 Bay",description:"Nợ Cũ"},{name:"Hai Tợ",description:"Nợ Cũ"},{name:"Sơn - Bên Sông",description:"Nợ Cũ"},{name:"Hai Bé - Xóm Trên",description:"Nợ Cũ"},{name:"Chị Ánh",description:"Nợ Cũ"},{name:"Dũng - An Phong",description:"Nợ Cũ"},{name:"9 Ghé - An Phong",description:"Nợ Cũ"},{name:"Anh Sáu Lập - Phú Ninh",description:"Nợ Cũ"},{name:"Mười Nỗi - Chợ mới",description:"Nợ Cũ"},{name:"Bác Ba Hanh",description:"Nợ Cũ"},{name:"Bảy Hiên",description:"Nợ Cũ"},{name:"Út Hùng - Hai Y",description:"Nợ Cũ"},{name:"Anh Hai Ngà - Phú Lợi",description:"Nợ Cũ"},{name:"Chị Hai Ê",description:"Nợ Cũ"},{name:"Hùng - Phú Thành B",description:"Nợ Cũ"},{name:"Vui - Tám Dũng",description:"Nợ Cũ"},{name:"Hai Bé Hô",description:"Nợ Cũ"},{name:"Hai Ghe",description:"Nợ Cũ"},{name:"Có - Út Cấm",description:"Nợ Cũ"},{name:"Đậm - Khu 3",description:"Nợ Cũ"},{name:"Tuấn Dung",description:"Nợ Cũ"},{name:"Tuấn 3 Hùng - Phú Lợi",description:"Nợ Cũ"},{name:"Ba Hùng - Phú Lợi",description:"Nợ Cũ"},{name:"Biều chị Hạnh",description:"Nợ Cũ"},{name:"Cậu 2 Tỷ",description:"Nợ Cũ"},{name:"Dì Thủy chị chú Hiếu",description:"Nợ Cũ"},{name:"Sang 8 Dũng",description:"Nợ Cũ"},{name:"Thuốc Ớt"},{name:"Anh Tòng",description:"Xóm Dưới"},{name:"Bác Tư Hiền"},{name:"Thà - Dì 5 Việt Anh",description:"Xóm Dưới"},{name:"Bác 6 Hùng",description:"Phú Thọ"},{name:"Bác 3 Khải"},{name:"dung"},{name:"Anh Hiền - 5 Cua",description:"Xóm Trên"},{name:"Chú Hậu",description:"Xóm Dưới"},{name:"Năm phướnG"},{name:"DÌ Tư Tuyền",description:"Xóm Dưới"},{name:"Tấn EM AO",description:"xôm dươi"},{name:"Anh Ba Đơ",description:"xôm Dưới"},{name:"Bác Ba Trung",description:"Phú Thành B"},{name:"Bác Năm Hùng",description:"Tam Nông"},{name:"Hải - Mười Phát",description:"Xóm Trên"},{name:"Bác Tư Đẹp",description:"An Long"},{name:"Chú Hoàng Phi"},{name:"Thiếm Năm Diền",description:"nợ củ"},{name:"Chú Tám"},{name:"Hai Bi",description:"Kinh Tế"},{name:"Chị Tiền",description:"SỐM DƯỚI"},{name:"ANH 6 HẢI",description:"PHÚ LỢI"},{name:"Linh - Năm Cua",description:"Xóm Trên"},{name:"Khách Hàng",description:"Vãng Lai"},{name:"Hồ Ngân",description:"Kinh Tế"},{name:"Anh Cường",description:"8 Bứu"},{name:"Chú 5 Cào",description:"Phú Ninh"},{name:"Chú Yên",description:"Tam Nông"},{name:"6 Chánh",description:"Xóm Dưới"},{name:"Anh Quân",description:"Phú Thọ"},{name:"Anh Hai Thòn",description:"Xóm Dưới"},{name:"Anh Vĩnh",description:"Phú Thành"},{name:"Bác Hai HIệp",description:"Xóm Trên"},{name:"Bác 2 Bao",description:"Bên Sông"},{name:"Tư Yến",description:"Xóm Trên"},{name:"Chú Hoàng - Xóm Dưới",description:"Vãng Lai"},{name:"Anh Xuân",description:"Xóm Dưới"},{name:"Chú Ân",description:"Tam Nông"},{name:"Bác Ba Dũng",description:"Phú Thọ"},{name:"Hiếu - Bảy Đức",description:"Vãng Lai"},{name:"Cô Hai Mum",description:"Xóm Trên"},{name:"Anh Giàu",description:"Phú Thọ"},{name:"Chú Lắc",description:"Xóm Trên"},{name:"Điều 5 Mật",description:"xôm dưới"},{name:"Duy Lam",description:"Phú Thọ"},{name:"Cô Kha",description:"Phú Thọ"},{name:"Anh Phước",description:"Xóm Trên"},{name:"Chú Út Em",description:"Tam Nông"},{name:"Chú Bình",description:"Tam Nông"},{name:"Dì Tư Lan",description:"Xóm Trên"},{name:"Anh Trong",description:"Xóm Dưới"},{name:"Dì 6 Mía",description:"Xóm Dưới"},{name:"Hải C.A",description:"Xóm Trên"},{name:"Anh Dương",description:"Xóm Dưới"},{name:"Anh Tú",description:"Xóm Dưới"},{name:"Anh Hải - Năm Cua",description:"Xóm Trên"},{name:"Bác Ba Đưng Sổ 02"},{name:"Anh Thanh",description:"Xóm Dưới"},{name:"Anh Giỏi",description:"Tam Nông"},{name:"Ba Lồng",description:"Kiên Lương"},{name:"Lam"},{name:"Lâm Phượng"},{name:"Dì Tuyết",description:"Xóm Trên"},{name:"Chị Huệ",description:"Xóm Dưới"},{name:"Cabin",description:"Xóm Trên"},{name:"Năm Giảng",description:"Xóm Dưới"},{name:"Sáu Dinh",description:"Xóm Dưới"},{name:"Út Phượng",description:"Xóm Dưới"},{name:"Năm Cua",description:"Xóm Trên"},{name:"Chú Hoàng - Tư Pháp",description:"Phú Thọ"},{name:"Bác Sáu Đực",description:"Xóm Trên"},{name:"Cậu Hoàng Phương",description:"Bảy Que"},{name:"Tư Kệ",description:"Phú Thọ"},{name:"Tư No",description:"Xóm Trên"},{name:"Hiếu Đồng Dưới",description:"Xốm Dưới"},{name:"Mười Điều",description:"Xóm Trên"},{name:"Anh Bạc",description:"Xóm Dưới"},{name:"Chú Ép",description:"Phú Thọ"},{name:"Bảy Hùng",description:"Kinh Tế"},{name:"Anh Tân",description:"bán thịt"},{name:"Cậu Sáu Hóa",description:"Xóm Trên"},{name:"Bác 5 Trung"},{name:"Hai Thùy",description:"Phú Thọ"},{name:"Chú Đẹt",description:"Kiên Lương"},{name:"Chú Sang",description:"Công An"},{name:"Anh Phương",description:"Xóm Dưới"},{name:"Tính",description:"2 đương"},{name:"Bác 4 Oi",description:"Bên Sông"},{name:"Anh Thuận",description:"Bên Sông"}]

@CustomerCreate = ()->
  Customer.insert(item.name, item.description) for item in a


scope = logics.customerManagement

lemon.defineHyper Template.customerManagementOverviewSection,
  avatarUrl: -> if @avatar then AvatarImages.findOne(@avatar)?.url() else undefined
  showEditCommand: -> Session.get "customerManagementShowEditCommand"
  showDeleteCommand: -> Session.get("customerManagementCurrentCustomer")?.allowDelete
  name: ->
    Meteor.setTimeout ->
      scope.overviewTemplateInstance.ui.$customerName.change()
    ,50 if scope.overviewTemplateInstance
    @name
  firstName: -> Helpers.firstName(@name)

  rendered: ->
    scope.overviewTemplateInstance = @
    @ui.$customerName.autosizeInput({space: 10})

  events:
    "click .avatar": (event, template) -> template.find('.avatarFile').click()
    "change .avatarFile": (event, template) ->
      files = event.target.files
      if files.length > 0
        AvatarImages.insert files[0], (error, fileObj) ->
          Schema.customers.update(Session.get('customerManagementCurrentCustomer')._id, {$set: {avatar: fileObj._id}})
          AvatarImages.findOne(Session.get('customerManagementCurrentCustomer').avatar)?.remove()

    "input .editable": (event, template) -> scope.checkAllowUpdateOverview(template)
    "keyup input.editable": (event, template) ->
      if Session.get("customerManagementCurrentCustomer")
        scope.editCustomer(template) if event.which is 13

        if event.which is 27
          if $(event.currentTarget).attr('name') is 'customerName'
            $(event.currentTarget).val(Session.get("customerManagementCurrentCustomer").name)
            $(event.currentTarget).change()
          else if $(event.currentTarget).attr('name') is 'customerPhone'
            $(event.currentTarget).val(Session.get("customerManagementCurrentCustomer").phone)
          else if $(event.currentTarget).attr('name') is 'customerAddress'
            $(event.currentTarget).val(Session.get("customerManagementCurrentCustomer").address)

          scope.checkAllowUpdateOverview(template)

    "click .syncCustomerEdit": (event, template) -> scope.editCustomer(template)
    "click .customerDelete": (event, template) -> scope.currentCustomer.remove()